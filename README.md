# Tcp over WebSocket (TCP to WebSocket, tcp2ws)
æœ¬å·¥å…·èƒ½ ä½¿ç”¨WebSocketåˆ›å»ºéš§é“ï¼Œå®ç°TCPç«¯å£è½¬å‘  
åœ¨v6.0åŠä»¥åçš„ç‰ˆæœ¬æ”¯æŒäº†wssï¼Œä¹Ÿå°±æ˜¯è¯´ç°åœ¨å¯ä»¥å®ç°https sslè¿›è¡Œæ›´å®‰å…¨çš„ä¼ è¾“
åœ¨v8.3åŠä»¥åçš„ç‰ˆæœ¬æ”¯æŒäº†ipä¼˜é€‰ï¼Œä¼šè‡ªåŠ¨é€‰æ‹©åŸŸåè§£æä¸­æœ€ä¼˜çš„cdn ipè¿›è¡Œè¿æ¥  
åœ¨v9.0åŠä»¥åçš„ç‰ˆæœ¬æ”¯æŒäº†UDPï¼Œä¹Ÿå°±æ˜¯è¯´ç°åœ¨å¯ä»¥å®ç°UDPç«¯å£è½¬å‘äº†  
ä¹Ÿå°±æ˜¯UDP over WebSocket (UDP to WebSocket, udp2ws) å¹¶æ²¡æœ‰ç‹¬ç«‹æˆæ–°ç¨‹åºï¼Œå†™åœ¨ä¸€èµ·äº†  
å¯åŠ¨æ—¶ä¼šåŒæ—¶è½¬å‘æŒ‡å®šçš„ç«¯å£çš„TCPå’ŒUDPæµé‡  

## å› ä¸ºç»å¸¸ä¿®æ”¹ä¼˜åŒ–ï¼Œæ‰€ä»¥è¯·Starï¼Œä¸è¦Fork  
### è‡³äºè¿™æ ·è„±è£¤å­æ”¾å±çš„æ“ä½œæœ‰ä»€ä¹ˆç”¨ï¼Ÿ  
ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªæœåŠ¡å™¨åªèƒ½é€šè¿‡cdnçš„httpè½¬å‘ï¼ˆæˆ–è€…httpsï¼‰ï¼Œå®ƒä¹Ÿä¸èƒ½è”ç½‘ï¼Œè¿™æ—¶ä½ å°±å¯ä»¥åˆ©ç”¨æ­¤å·¥å…·å°†éœ€è¦è½¬å‘çš„ç«¯å£ï¼ˆæ¯”å¦‚22ï¼‰è½¬æ¢æˆwsåè®®ï¼ˆhttpï¼‰æ¥ä¼ è¾“ï¼Œå†å»Nginxé‡Œé¢é…ä¸€ä¸ªåå‘ä»£ç†ï¼Œé‚£ä¹ˆå½“æœ¬å®¢æˆ·ç«¯è®¿é—®Nginxæä¾›çš„æœåŠ¡çš„ç‰¹å®šè·¯å¾„æ—¶å°†åä»£åˆ°æœ¬æœåŠ¡ç«¯ï¼Œå®ç°å†…ç½‘ç©¿é€è¿›è¡Œç«¯å£è½¬å‘  
å½“ç„¶Nginxä¸æ˜¯å¿…é¡»çš„ï¼Œç›´æ¥æŠŠç›‘å¬ç«¯å£å¼€æ”¾åˆ°å…¬ç½‘ä¸Šä¹Ÿè¡Œ
è¿™æ—¶é˜²ç«å¢™ä»…ä»…å‘ç°ä½ è¿æ¥äº†ä¸€ä¸ªWebSocketè€Œå·²
å¹¶ä¸”åœ¨ç½‘ç»œä¸ç¨³å®šæ—¶ï¼Œæ–­å¼€çš„wsä¼šè‡ªåŠ¨é‡è¿ï¼Œä¿æŒç€è½¬å‘çš„tcpè¿æ¥ï¼ˆæ–­å¼€wsè¶…è¿‡2åˆ†é’Ÿtcpè¿æ¥å°†è¢«æ–­å¼€ï¼‰  

### ä¼¼ä¹æœ‰åˆ«çš„å·¥å…·ä¹Ÿèƒ½å®ç±»ä¼¼çš„åŠŸèƒ½ï¼Œå†™å®ƒå¹²å˜›ï¼Ÿ
æœ€åˆä¸ºäº†å®ç°å°†sshç”¨Nginxè½¬å‘ï¼Œå†™çš„æ—¶å€™è¿˜æ²¡æ‰¾åˆ°è¿™ç§å·¥å…·ï¼Œæ‰€ä»¥å…ˆå®ç°äº†tcpæ”¾åˆ°wsä¸­ä¼ è¾“ï¼Œä½†åƒNginxå°±ç®—æ˜¯wsé•¿é“¾æ¥ï¼Œæ ¹æ®[å®˜æ–¹æ–‡æ¡£](http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_connect_timeout)æè¿°ï¼Œè¿æ¥è¶…æ—¶æ—¶é—´æ— è®ºé…ç½®å¤šå¤§ï¼Œé€šå¸¸éƒ½ä¸èƒ½è¿æ¥è¶…è¿‡75ç§’ï¼Œæ—¶é—´ä¸€åˆ°sshå°±ä¼šæ–­ï¼Œäºæ˜¯å®ç°äº†é‡è¿å’Œé‡å‘ï¼Œè¿™æ˜¯åˆ«çš„å·¥å…·æ²¡æœ‰çš„  
è¿™ä¸ªå·¥å…·ä¹Ÿä¸ä¼šæœ‰å¤ªå¤šèŠ±é‡Œèƒ¡å“¨çš„åŠŸèƒ½ï¼Œå¹²å¥½å®ƒçš„æœ¬èŒå·¥ä½œ

### é‚£ä¸ºä»€ä¹ˆè¦æ”¯æŒUDPå‘¢ï¼Ÿ
UDPæ˜¯ä¸å¯é çš„ï¼Œæ‰€ä»¥åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½ä¼šä¸¢åŒ…ï¼Œä½†æ˜¯è¿™ä¸ªå·¥å…·ä¼šè‡ªåŠ¨é‡ä¼ ä¸¢å¤±çš„æ•°æ®åŒ…  
ä¾‹å¦‚ç”¨åšDnsè½¬å‘ï¼ŒWebSocketä¼šåœ¨å®¢æˆ·ç«¯å‘é€UDPæ•°æ®åŒ…æ—¶æ‰åˆ›å»ºè¿æ¥ï¼Œå¹¶ä¸”åœ¨2åˆ†é’Ÿè¶…æ—¶åè‡ªåŠ¨æ–­å¼€ï¼Œæ—¢ä¿è¯äº†è¿æ¥ç¨³å®šæ€§ï¼Œåˆä¸ä¼šä¸€ç›´æŒ‚ç€è¿æ¥å ç”¨èµ„æº

## å¦‚ä½•ä½¿ç”¨
åœ¨å³è¾¹Releasesä¸­é€‰æ‹©ä½ ä½¿ç”¨çš„å¹³å°çš„ç¨‹åºæ¥è¿è¡Œ  
æœåŠ¡ç«¯ï¼š  
`tcp2ws è¦ä»£ç†çš„ip:ç«¯å£ æœ¬wsæœåŠ¡çš„ç›‘å¬ç«¯å£`   
`tcp2ws æœ¬åœ°ç«¯å£ æœ¬wsæœåŠ¡çš„ç›‘å¬ç«¯å£`  
`tcp2ws æœ¬åœ°ç«¯å£ ç›‘å¬ip:æœ¬wsæœåŠ¡çš„ç›‘å¬ç«¯å£`   
å®¢æˆ·ç«¯ï¼š  
`tcp2ws ws://é“¾æ¥ æœ¬åœ°ç›‘å¬ç«¯å£`  
`tcp2ws http://é“¾æ¥ æœ¬åœ°ç›‘å¬ç«¯å£`  

å¦å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨wss(https ssl)åè®®ï¼Œsslæ›´ä¸ºå®‰å…¨ï¼Œä½†éœ€è¦æ¶ˆè€—æ›´å¤šæµé‡ï¼Œéœ€è¦æŒ‡å®šè¯ä¹¦è·¯å¾„ï¼Œå¦å¤–é¡ºå¸¦æä¸€ä¸‹nginxå¯ä»¥æŠŠwss(https)è½¬å‘åˆ°ws(http)  
æœåŠ¡ç«¯ï¼š  
`tcp2ws è¦ä»£ç†çš„ip:ç«¯å£ æœ¬wsæœåŠ¡çš„ç›‘å¬ç«¯å£ è¯ä¹¦.crt è¯ä¹¦.key`
`tcp2ws æœ¬åœ°ç«¯å£ æœ¬wsæœåŠ¡çš„ç›‘å¬ç«¯å£ è¯ä¹¦.crt è¯ä¹¦.key`   
`tcp2ws æœ¬åœ°ç«¯å£ ç›‘å¬ip:æœ¬wsæœåŠ¡çš„ç›‘å¬ç«¯å£ è¯ä¹¦.crt è¯ä¹¦.key`   
ä½¿ç”¨é»˜è®¤çš„æ–‡ä»¶å server.crt server.keyï¼ˆè¿™é‡Œçš„`wss`ä¹Ÿå¯ä»¥æ˜¯`https`æˆ–`ssl`ï¼‰   
`tcp2ws è¦ä»£ç†çš„ip:ç«¯å£ æœ¬wsæœåŠ¡çš„ç›‘å¬ç«¯å£ wss`  
å®¢æˆ·ç«¯ï¼š  
`tcp2ws wss://é“¾æ¥ æœ¬åœ°ç›‘å¬ç«¯å£`  
`tcp2ws https://é“¾æ¥ æœ¬åœ°ç›‘å¬ç«¯å£`  

ç”Ÿæˆè‡ªç­¾è¯ä¹¦çš„æ–¹æ³•ï¼ˆä¸€è·¯å›è½¦å³å¯ï¼‰ï¼š  
```
openssl genrsa -out server.key 2048
openssl ecparam -genkey -name secp384r1 -out server.key
openssl req -new -x509 -sha256 -key server.key -out server.crt -days 36500
```

ä¸¾ä¸ªğŸŒ°ï¼š  
åœ¨æœåŠ¡å™¨è¿è¡Œ`tcp2ws 127.0.0.1:22 127.0.0.1:22222`  
ç„¶ååœ¨nginxä¸­åä»£äº†ä¸€ä¸‹  
åœ¨å®¢æˆ·ç«¯è¿è¡Œ`tcp2ws ws://yourdomain.com/ssh/ 222`  
é‚£ä¹ˆå°±å¯ä»¥é€šè¿‡å®¢æˆ·ç«¯çš„222æ¥è®¿é—®æœåŠ¡å™¨çš„sshå•¦  
æ˜¯ä¸æ˜¯ç‰¹åˆ«æ£’å‘¢  

è¿˜å¯ä»¥å†™ä¸€ä¸ªæ­»å¾ªç¯æ¥å®ˆæŠ¤è¿è¡Œ 
`while true;do;tcp2ws 127.0.0.1:22 127.0.0.1:22222;done`  
æˆ–è€…ç”¨screenæ¥åå°è¿è¡Œ  
`screen -dmS tcp2ws bash -c "tcp2ws 127.0.0.1:22 127.0.0.1:22222"`

## é€Ÿåº¦
åœ¨ä¹ä¸ç‰ˆM1 Proçš„macOSä¸‹ä½¿ç”¨æœ¬å·¥å…·æ¥å›è½¬æ¢iperf3ç«¯å£æµ‹è¯•å¾—åˆ°çš„æ•°æ®
```
[ ID] Interval           Transfer     Bitrate
[  5]   0.00-1.00   sec   988 MBytes  8.28 Gbits/sec
[  5]   1.00-2.00   sec   977 MBytes  8.19 Gbits/sec
[  5]   2.00-3.00   sec   982 MBytes  8.23 Gbits/sec
[  5]   3.00-4.00   sec   994 MBytes  8.34 Gbits/sec
[  5]   4.00-5.00   sec   966 MBytes  8.10 Gbits/sec
[  5]   5.00-6.00   sec   982 MBytes  8.24 Gbits/sec
[  5]   6.00-7.00   sec   989 MBytes  8.30 Gbits/sec
[  5]   7.00-8.00   sec   935 MBytes  7.84 Gbits/sec
[  5]   8.00-9.00   sec  1004 MBytes  8.42 Gbits/sec
[  5]   9.00-10.00  sec   984 MBytes  8.26 Gbits/sec
- - - - - - - - - - - - - - - - - - - - - - - - -
[ ID] Interval           Transfer     Bitrate
[  5]   0.00-10.00  sec  9.57 GBytes  8.22 Gbits/sec                  sender
[  5]   0.00-10.00  sec  9.56 GBytes  8.21 Gbits/sec                  receiver
```
èµ°wssï¼Œå› ä¸ºsslï¼Œé€Ÿåº¦è‚‰çœ¼å¯è§ä¸‹é™:
```
[ ID] Interval           Transfer     Bitrate
[  5]   0.00-10.00  sec  7.38 GBytes  6.34 Gbits/sec                  sender
[  5]   0.00-10.00  sec  7.38 GBytes  6.33 Gbits/sec                  receiver
```
ç›´è¿
```
[ ID] Interval           Transfer     Bitrate
[  5]   0.00-10.00  sec   119 GBytes   102 Gbits/sec                  sender
[  5]   0.00-10.00  sec   119 GBytes   102 Gbits/sec                  receiver
```
åœ¨i7-8550uçš„Windowsä¸‹ä½¿ç”¨æœ¬å·¥å…·æ¥å›è½¬æ¢iperf3ç«¯å£æµ‹è¯•å¾—åˆ°çš„æ•°æ®
```
[ ID] Interval           Transfer     Bandwidth
[  4]   0.00-1.00   sec   300 MBytes  2.52 Gbits/sec
[  4]   1.00-2.00   sec   336 MBytes  2.81 Gbits/sec
[  4]   2.00-3.00   sec   320 MBytes  2.68 Gbits/sec
[  4]   3.00-4.00   sec   317 MBytes  2.66 Gbits/sec
[  4]   4.00-5.00   sec   302 MBytes  2.53 Gbits/sec
[  4]   5.00-6.00   sec   328 MBytes  2.75 Gbits/sec
[  4]   6.00-7.00   sec   312 MBytes  2.61 Gbits/sec
[  4]   7.00-8.00   sec   319 MBytes  2.67 Gbits/sec
[  4]   8.00-9.00   sec   322 MBytes  2.70 Gbits/sec
[  4]   9.00-10.00  sec   348 MBytes  2.92 Gbits/sec
- - - - - - - - - - - - - - - - - - - - - - - - -
[ ID] Interval           Transfer     Bandwidth
[  4]   0.00-10.00  sec  3.14 GBytes  2.70 Gbits/sec                  sender
[  4]   0.00-10.00  sec  3.13 GBytes  2.69 Gbits/sec                  receiver
```
ä¸¤ä¸ªiperf3ç›´è¿
```
[ ID] Interval           Transfer     Bandwidth
[  4]   0.00-10.00  sec  9.53 GBytes  8.19 Gbits/sec                  sender
[  4]   0.00-10.00  sec  9.53 GBytes  8.19 Gbits/sec                  receiver
```

## ä¼ªè£…
åœ¨ç›´æ¥è®¿é—®ç›‘å¬ç«¯å£çš„ä»»æ„è·¯å¾„ï¼Œé»˜è®¤ä¼šè¿”å›ä¸€ä¸ªç©ºç™½é¡µé¢  
å¯ä»¥å†™ä¸€ä¸ª`index.html`æ”¾åˆ°è¿è¡Œç›®å½•ä¸‹æ¥ä»£æ›¿è¿™ä¸ªç©ºç™½é¡µé¢
ç›´æ¥è®¿é—®æ—¶å°±ä¼šæ˜¾ç¤ºè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œä¼ªè£…æˆä¸€ä¸ªéå¸¸æ™®é€šçš„WebæœåŠ¡  
æ¨èç”¨ä¸€ä¸ªå«SingleFileçš„æ’ä»¶å¯ä»¥æŠŠé¡µé¢ç›´æ¥å­˜æˆä¸€ä¸ªæ–‡ä»¶


### åè®® å’©License
ä½¿ç”¨æ­¤é¡¹ç›®è§†ä¸ºæ‚¨å·²é˜…è¯»å¹¶åŒæ„éµå®ˆ [æ­¤LICENSE](https://github.com/zanjie1999/LICENSE)   
Using this project is deemed to indicate that you have read and agreed to abide by [this LICENSE](https://github.com/zanjie1999/LICENSE)   


